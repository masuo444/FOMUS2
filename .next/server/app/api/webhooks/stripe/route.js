"use strict";(()=>{var e={};e.id=798,e.ids=[798],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},3837:e=>{e.exports=require("util")},5060:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>l,originalPathname:()=>h,requestAsyncStorage:()=>c,routeModule:()=>n,serverHooks:()=>d,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>m});var o={};r.r(o),r.d(o,{POST:()=>POST});var s=r(884),a=r(6132),i=r(5798),u=r(8761);async function POST(e){try{let t=await e.text(),r=e.headers.get("stripe-signature");if(!r)return i.Z.json({error:"Missing stripe signature"},{status:400});let o=(0,u.po)(t,r);if("checkout.session.completed"===o.type){let e=o.data.object;if(console.log("✅ Payment completed:",{sessionId:e.id,customerEmail:e.customer_details?.email,amountTotal:e.amount_total,currency:e.currency,metadata:e.metadata}),e.metadata?.priceId?.includes("passport")){let t=e.metadata.priceId.includes("vip")?"VIP":"Standard";console.log("\uD83C\uDFAB NFT minted:",{type:`${t} Passport`,background:"VIP"===t?"Gold":"Silver",customerEmail:e.customer_details?.email,tokenId:Math.floor(1e4*Math.random())}),console.log("\uD83D\uDCE7 Welcome email sent to:",e.customer_details?.email),"VIP"===t&&console.log("\uD83D\uDCC5 VIP calendar access granted")}e.metadata?.priceId?.includes("tea")&&console.log("\uD83C\uDF75 Tea subscription activated"),e.metadata?.priceId?.includes("craft")&&console.log("\uD83C\uDFA8 Craft order processed")}return i.Z.json({received:!0})}catch(e){return console.error("❌ Webhook error:",e),i.Z.json({error:"Webhook processing failed"},{status:500})}}let n=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/webhooks/stripe/route",pathname:"/api/webhooks/stripe",filename:"route",bundlePath:"app/api/webhooks/stripe/route"},resolvedPagePath:"/Users/masuo/Desktop/FOMUS プレミアム/app/api/webhooks/stripe/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:d,headerHooks:l,staticGenerationBailout:m}=n,h="/api/webhooks/stripe/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[6,241,761],()=>__webpack_exec__(5060));module.exports=r})();