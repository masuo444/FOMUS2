"use strict";exports.id=761,exports.ids=[761],exports.modules={8761:(e,t,r)=>{r.d(t,{Mc:()=>createCheckoutSession,ZP:()=>i,cC:()=>_,po:()=>verifyWebhookSignature});var s=r(8888);let a=new s.Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2023-10-16"}),n={vip_passport:{application_fee_percent:5},standard_passport:{application_fee_percent:3},craft_products:{application_fee_percent:8},tea_subscription:{application_fee_percent:4},nft_collectibles:{application_fee_percent:2.5}},_={membership_standard:"price_membership_standard_100000",membership_vip:"price_membership_vip_1000000",membership_vvip:"price_membership_vvip_10000000",vip_passport_usd:"price_vip_passport_usd_10000",vip_passport_aed:"price_vip_passport_aed_36700",vip_passport_eur:"price_vip_passport_eur_8500",standard_enrollment_usd:"price_standard_enrollment_usd_1200",standard_annual_usd:"price_standard_annual_usd_500",tea_matcha_discovery:"price_tea_matcha_discovery_3000",tea_sencha_connoisseur:"price_tea_sencha_connoisseur_5000",tea_master:"price_tea_master_12000"};async function createCheckoutSession({priceId:e,mode:t="payment",metadata:r={},customerEmail:s,successUrl:n,cancelUrl:_}){try{let i=await a.prices.retrieve(e),p=getConnectAccountId(e),c=getApplicationFeePercent(e),o={mode:t,line_items:[{price:e,quantity:1}],success_url:n,cancel_url:_,customer_email:s,metadata:{...r,priceId:e,timestamp:Date.now().toString()},...p&&{payment_intent_data:{application_fee_amount:Math.round((i.unit_amount||0)*(c/100)),transfer_data:{destination:p}}},webhook_endpoints:[{url:`${process.env.NEXT_PUBLIC_APP_URL}/api/webhooks/stripe`,enabled_events:["checkout.session.completed"]}]},u=await a.checkout.sessions.create(o);return u}catch(e){throw console.error("Stripe checkout session creation error:",e),Error("Failed to create checkout session")}}function getConnectAccountId(e){return e.includes("craft")?process.env.STRIPE_CRAFT_CONNECT_ACCOUNT_ID:e.includes("tea")?process.env.STRIPE_TEA_CONNECT_ACCOUNT_ID:void 0}function getApplicationFeePercent(e){return e.includes("vip_passport")?n.vip_passport.application_fee_percent:e.includes("standard")?n.standard_passport.application_fee_percent:e.includes("craft")?n.craft_products.application_fee_percent:e.includes("tea")?n.tea_subscription.application_fee_percent:e.includes("nft")?n.nft_collectibles.application_fee_percent:5}function verifyWebhookSignature(e,t){let r=process.env.STRIPE_WEBHOOK_SECRET;return a.webhooks.constructEvent(e,t,r)}let i=a}};